<!-- ** START template/system/logfile.html 00:29 08.01.2018 ************************************************************************** -->
<div style="margin: 2%">
				
	<!-- <div style="width:100%; height:57vh;"> -->
	<div id="pstatus"><TMPL_VAR PLUGININSTALL.UI_INSTALL_LABEL_TITLE></div>
	<br>
	<div style="width:100%; height:40vh; background-color: transparent; font-family:monospace; color:#8080FF; overflow-y: scroll" id="Logfile" contenteditable="true">
	</div>
	
	<!-- </div> -->
	<table width="100%" border="0">
		<tr>
			<td width="100%">
			</td>
			<td>
			<label style="display:block; text-align:center; width:70px; height: 15px; font-size:11;"><input data-mini="true" type="checkbox" checked id="LogScroll"><TMPL_VAR LOGVIEWER.BUTTON_AUTOSCROLL></label>
			</td>
			<td>
			<a style="display:block; text-align:center; width:60px; height: 14px; font-size:11;" id="download" data-role="button" data-inline="true" data-mini="true" data-icon="arrow-d" href="#" target="_blank"><TMPL_VAR COMMON.BUTTON_DOWNLOAD></a>
			</td>
		</tr>
	</table>

	<p>
	<center>
	<table border=0>
		<tr>
			<td>
			<a id="btnnext" data-role="button" data-inline="true" data-mini="true" data-icon="check" href="/admin/system/plugininstall.cgi?do=form"><TMPL_VAR PLUGININSTALL.UI_INSTALL_LABEL_NEXT></a>
			</td>
			<td>
			<a id="btnreboot" data-role="button" data-inline="true" data-mini="true" data-icon="check" href="/admin/system/power.cgi"><TMPL_VAR PLUGININSTALL.UI_INSTALL_LABEL_REBOOT></a>
			</td>
		</tr>
	</table>
	</center>
	</p>

</div>

<script>

// Disable buttons
$('#btnnext').addClass('ui-disabled');
$('#btnreboot').addClass('ui-disabled');

function updatelog() 
{
	// Disable caching of AJAX responses
	$.ajaxSetup (
	{
		cache: false
	});
	// Load Logfile
	$('#Logfile').load('/admin/system/tools/logfile.cgi?logfile=<TMPL_VAR LOGFILE>&head=none&format=html');
	if ($("#LogScroll").is(":checked"))
	{
		$("#Logfile").scrollTop($("#Logfile")[0].scrollHeight);
	}
	// Load Status
	$.get('/admin/system/tools/logfile.cgi?logfile=<TMPL_VAR STATUSFILE>&head=none&format=ascii', function (response)
	{
		var pstatus = parseInt(response);
		if (pstatus == 3)
		{
			document.getElementById("pstatus").innerHTML = "<b><TMPL_VAR PLUGININSTALL.UI_INSTALL_LABEL_REBOOTREQUIRED></b>";
			$('#btnnext').removeClass('ui-disabled');
			$('#btnreboot').removeClass('ui-disabled');
		}
		else if (pstatus == 2)
		{
			document.getElementById("pstatus").innerHTML = "<b><font color='#FF0000'><TMPL_VAR PLUGININSTALL.UI_INSTALL_LABEL_ERROR></font></b>";
			$('#btnnext').removeClass('ui-disabled');
		}
		else if (pstatus == 1)
		{
			document.getElementById("pstatus").innerHTML = "<b><TMPL_VAR PLUGININSTALL.UI_INSTALL_LABEL_TITLE></b>";
			$('#btnnext').addClass('ui-disabled');
		}
		else
		{
			document.getElementById("pstatus").innerHTML = "<b><TMPL_VAR PLUGININSTALL.UI_INSTALL_LABEL_SUCCESS></b>";
			$('#btnnext').removeClass('ui-disabled');
		}
	});
	return;
}
var interval = window.setInterval(updatelog, 1000);

$("#Logfile").click(function() {
		clearInterval(interval);
		$("input[type='checkbox']").attr("checked",false).checkboxradio("refresh");
});

$("#LogScroll").click(function() {
		if ( $(this).is(':checked') ) {
			$("#Logfile").scrollTop($("#Logfile")[0].scrollHeight).delay(100);
			interval = window.setInterval(updatelog, 1000);
		} else {
			clearInterval(interval);
		}
});

var fileName =  'logfile.txt';
function downloadDiv(filename, elementId, mimeType) {
    var elementHtml = $('#Logfile').text();
	elementHtml.replace(/[\n]/g, '\r\n');
	var link = document.createElement('a');
    mimeType = mimeType || 'text/plain';

    link.setAttribute('download', filename);
    link.setAttribute('href', 'data:' + mimeType  +  ';charset=utf-8,' + encodeURIComponent(elementHtml));
    link.click(); 
}


$('#download').click(function(){
    downloadDiv(fileName, 'LogFile','text/html');
});

</script>
				
